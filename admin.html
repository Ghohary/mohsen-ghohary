<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management - Mohsen Ghohary</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            background: #f5f5f5;
            min-height: 100vh;
        }

        .admin-container {
            max-width: 1300px;
            margin: 0 auto;
            padding: 3rem 1.5rem;
        }

        .admin-header {
            text-align: center;
            margin-bottom: 4rem;
            animation: fadeInDown 0.8s ease;
        }

        .admin-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #000;
            margin-bottom: 0.5rem;
        }

        .admin-header p {
            color: #666;
            font-size: 1rem;
            letter-spacing: 0.08em;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-section {
            background: #fff;
            padding: 3rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 3rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            animation: fadeInUp 0.8s ease;
        }

        .form-section h2 {
            color: #000;
            margin-bottom: 2rem;
            font-size: 1.3rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            border-bottom: 2px solid #000;
            padding-bottom: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 0.85rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-bottom: 0.8rem;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s;
            background: #fafafa;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #000;
            background: #fff;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .images-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .image-preview-item {
            position: relative;
            width: 150px;
            height: 200px;
            background: #f5f5f5;
            border: 2px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            transition: all 0.3s;
            cursor: grab;
            user-select: none;
        }

        .image-preview-item.dragging {
            opacity: 0.5;
            transform: scale(0.95);
            cursor: grabbing;
        }

        .image-preview-item.drag-over {
            border-color: #000;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }

        .image-order-badge {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .remove-image-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .remove-image-btn:hover {
            background: rgba(0, 0, 0, 1);
        }

        .colors-section {
            margin-bottom: 2.5rem;
            padding: 2rem;
            background: #fafafa;
            border-radius: 4px;
            border-left: 4px solid #000;
        }

        .colors-section h3 {
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-bottom: 1.5rem;
            color: #000;
        }

        .color-item {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1rem;
            padding: 1.2rem;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            align-items: center;
            transition: all 0.3s;
        }

        .color-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: #000;
        }

        .color-input {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex: 1;
        }

        .color-picker {
            width: 60px;
            height: 60px;
            border: 2px solid #000;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .color-picker:hover {
            transform: scale(1.05);
        }

        .color-name {
            flex: 1;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .color-name:focus {
            border-color: #000;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
        }

        .size-selector {
            margin-bottom: 2rem;
        }

        .size-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 1rem;
            padding: 1.5rem;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .size-checkbox {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background: #fafafa;
            border: 2px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .size-checkbox input {
            margin-right: 0.5rem;
            cursor: pointer;
            width: 16px;
            height: 16px;
        }

        .size-checkbox:hover {
            border-color: #000;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .size-checkbox input:checked {
            accent-color: #000;
        }

        .sizes-section {
            margin-bottom: 2.5rem;
            padding: 2rem;
            background: #fafafa;
            border-radius: 4px;
            border-left: 4px solid #000;
        }

        .sizes-section h3 {
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-bottom: 1.5rem;
            color: #000;
        }

        .inventory-input-table {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }

        .inventory-input-header {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 1rem;
            padding: 1.2rem;
            background: #000;
            color: #fff;
            font-weight: 700;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            font-size: 0.85rem;
        }

        .inventory-input-col {
            display: flex;
            align-items: center;
        }

        .inventory-input-row {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid #ddd;
            align-items: center;
        }

        .inventory-input-row:last-child {
            border-bottom: none;
        }

        .inventory-input-row:nth-child(even) {
            background: #fafafa;
        }

        .inventory-input-row input {
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        .inventory-input-row input:focus {
            outline: none;
            border-color: #000;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
        }

        .inventory-input-row input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            font-weight: 700;
            transition: all 0.3s;
            border-radius: 4px;
        }

        .btn-primary {
            background: #000;
            color: #fff;
            border: 2px solid #000;
        }

        .btn-primary:hover {
            background: #fff;
            color: #000;
        }

        .btn-danger {
            background: #999;
            color: #fff;
            padding: 0.6rem 1.2rem;
            font-size: 0.75rem;
            border: 2px solid #999;
        }

        .btn-danger:hover {
            background: #fff;
            color: #999;
        }

        .btn-add {
            background: #666;
            color: #fff;
            border: 2px solid #666;
        }

        .btn-add:hover {
            background: #fff;
            color: #666;
        }

        .products-list {
            margin-top: 4rem;
        }

        .products-list h2 {
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-bottom: 2.5rem;
            color: #000;
            border-bottom: 3px solid #000;
            padding-bottom: 1rem;
        }

        .product-item {
            background: #fff;
            padding: 2rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 2rem;
            display: grid;
            grid-template-columns: 180px 1fr;
            gap: 2.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
            animation: fadeInUp 0.6s ease;
        }

        .product-item:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border-color: #000;
        }

        .product-image {
            position: relative;
            width: 180px;
            height: 240px;
            background: #f5f5f5;
            overflow: hidden;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .product-item:hover .product-image img {
            transform: scale(1.05);
        }

        .product-details {
            display: flex;
            flex-direction: column;
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .product-name {
            font-size: 1.4rem;
            font-weight: 700;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: #000;
        }

        .product-category {
            font-size: 0.8rem;
            color: #666;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-top: 0.4rem;
            font-weight: 600;
        }

        .product-price {
            font-size: 1.3rem;
            color: #333;
            font-weight: 700;
            margin-bottom: 1rem;
            letter-spacing: 0.05em;
        }

        .product-desc {
            font-size: 0.95rem;
            color: #555;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .product-colors {
            margin-bottom: 1.5rem;
        }

        .product-colors label {
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            display: block;
            margin-bottom: 0.8rem;
            color: #333;
        }

        .color-dots {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
        }

        .color-dot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.3s;
        }

        .color-dot:hover {
            transform: scale(1.15);
            border-color: #000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
            background: #fafafa;
            border-radius: 4px;
            overflow: hidden;
        }

        .inventory-table th,
        .inventory-table td {
            padding: 1rem;
            text-align: left;
            font-size: 0.9rem;
            border: 1px solid #ddd;
        }

        .inventory-table th {
            background: #000;
            color: #fff;
            font-weight: 700;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .inventory-table tr:nth-child(even) {
            background: #fff;
        }

        .inventory-table tr:nth-child(odd) {
            background: #fafafa;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .product-item {
                grid-template-columns: 1fr;
            }

            .admin-header h1 {
                font-size: 1.8rem;
            }

            .form-section {
                padding: 2rem;
            }
        }
    </style>
</head>
<body>
    <div id="header-container"></div>

    <div class="admin-container">
        <div class="admin-header">
            <h1>Product Management</h1>
            <p>Create and manage your luxury products</p>
        </div>

        <div class="form-section">
            <h2>Create New Product</h2>

            <div class="form-row full">
                <div class="form-group">
                    <label>Product Name <span style="color: #999;">(Required)</span></label>
                    <input type="text" id="productName" placeholder="Enter product name">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Category <span style="color: #999;">(Optional)</span></label>
                    <select id="productCategory">
                        <option value="">Select Category</option>
                        <option value="Dresses">Dresses</option>
                        <option value="Bags">Bags</option>
                        <option value="Outerwear">Outerwear</option>
                        <option value="Footwear">Footwear</option>
                        <option value="Accessories">Accessories</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Price <span style="color: #999;">(Optional)</span></label>
                    <input type="number" id="productPrice" placeholder="e.g., 5200">
                </div>
            </div>

            <div class="form-row full">
                <div class="form-group">
                    <label>Description <span style="color: #999;">(Optional)</span></label>
                    <textarea id="productDescription" placeholder="Enter product description"></textarea>
                </div>
            </div>

            <div class="form-row full">
                <div class="form-group">
                    <label>Product Images <span style="color: #999;">(Required)</span></label>
                    <input type="file" id="productImage" accept="image/*" multiple>
                    <div class="images-preview" id="imagesPreview"></div>
                </div>
            </div>

            <div class="colors-section">
                <h3>Available Colors <span style="color: #999; font-size: 0.8rem; font-weight: 400;">(Optional)</span></h3>
                <div id="colorsList"></div>
                <button class="btn btn-add" type="button" onclick="addColorInput()">+ Add Color</button>
            </div>

            <div class="sizes-section">
                <h3>Select Available Sizes <span style="color: #999; font-size: 0.8rem; font-weight: 400;">(Optional)</span></h3>
                <div class="size-selector">
                    <div class="size-grid" id="sizeSelector">
                        <label class="size-checkbox">
                            <input type="checkbox" value="One Size"> One Size
                        </label>
                        <label class="size-checkbox">
                            <input type="checkbox" value="32"> 32
                        </label>
                        <label class="size-checkbox">
                            <input type="checkbox" value="34"> 34
                        </label>
                        <label class="size-checkbox">
                            <input type="checkbox" value="36"> 36
                        </label>
                        <label class="size-checkbox">
                            <input type="checkbox" value="38"> 38
                        </label>
                        <label class="size-checkbox">
                            <input type="checkbox" value="40"> 40
                        </label>
                        <label class="size-checkbox">
                            <input type="checkbox" value="42"> 42
                        </label>
                        <label class="size-checkbox">
                            <input type="checkbox" value="44"> 44
                        </label>
                        <label class="size-checkbox">
                            <input type="checkbox" value="46"> 46
                        </label>
                        <label class="size-checkbox">
                            <input type="checkbox" value="48"> 48
                        </label>
                        <label class="size-checkbox">
                            <input type="checkbox" value="50"> 50
                        </label>
                        <label class="size-checkbox">
                            <input type="checkbox" value="52"> 52
                        </label>
                    </div>
                </div>

                <h3 style="margin-top: 2rem;">Set Inventory Quantities</h3>
                <div class="inventory-input-table">
                    <div class="inventory-input-header">
                        <div class="inventory-input-col">Size</div>
                        <div class="inventory-input-col">Quantity</div>
                        <div class="inventory-input-col">Out of Stock</div>
                    </div>
                    <div id="inventoryInputList"></div>
                </div>
            </div>

            <div class="form-row full" style="margin-top: 2rem;">
                <button class="btn btn-primary" type="button" onclick="createProduct()" style="width: 100%;">Create Product</button>
            </div>
        </div>

        <div class="products-list">
            <h2>Your Products</h2>
            <div id="productsList"></div>
        </div>
    </div>

    <!-- Edit Product Modal -->
    <div id="editModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; overflow-y: auto;">
        <div style="background: #fff; margin: 2rem auto; padding: 2rem; max-width: 600px; border-radius: 8px; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; border-bottom: 2px solid #000; padding-bottom: 1rem;">
                <h2 style="font-size: 1.5rem; font-weight: 700; text-transform: uppercase; color: #000; margin: 0;">Edit Product</h2>
                <button type="button" onclick="closeEditModal()" style="background: none; border: none; font-size: 2rem; cursor: pointer; color: #666;">&times;</button>
            </div>

            <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                <div>
                    <label style="font-size: 0.85rem; font-weight: 700; text-transform: uppercase; color: #333; display: block; margin-bottom: 0.5rem;">Product Name</label>
                    <input type="text" id="editProductName" style="width: 100%; padding: 1rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                </div>

                <div>
                    <label style="font-size: 0.85rem; font-weight: 700; text-transform: uppercase; color: #333; display: block; margin-bottom: 0.5rem;">Category</label>
                    <select id="editProductCategory" style="width: 100%; padding: 1rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                        <option value="Uncategorized">Uncategorized</option>
                        <option value="Dresses">Dresses</option>
                        <option value="Bags">Bags</option>
                        <option value="Outerwear">Outerwear</option>
                        <option value="Footwear">Footwear</option>
                        <option value="Accessories">Accessories</option>
                    </select>
                </div>

                <div>
                    <label style="font-size: 0.85rem; font-weight: 700; text-transform: uppercase; color: #333; display: block; margin-bottom: 0.5rem;">Price</label>
                    <input type="number" id="editProductPrice" style="width: 100%; padding: 1rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                </div>

                <div>
                    <label style="font-size: 0.85rem; font-weight: 700; text-transform: uppercase; color: #333; display: block; margin-bottom: 0.5rem;">Description</label>
                    <textarea id="editProductDescription" style="width: 100%; padding: 1rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; min-height: 100px; resize: vertical;"></textarea>
                </div>

                <div style="border-top: 1px solid #ddd; padding-top: 1rem;">
                    <label style="font-size: 0.85rem; font-weight: 700; text-transform: uppercase; color: #333; display: block; margin-bottom: 1rem;">Edit Sizes & Inventory</label>
                    <div class="inventory-input-table">
                        <div class="inventory-input-header">
                            <div class="inventory-input-col">Size</div>
                            <div class="inventory-input-col">Quantity</div>
                            <div class="inventory-input-col">Out of Stock</div>
                        </div>
                        <div id="editInventoryList"></div>
                    </div>
                </div>

                <div style="display: flex; gap: 1rem;">
                    <button type="button" onclick="saveEditProduct()" style="flex: 1; padding: 1rem; background: #000; color: #fff; border: none; border-radius: 4px; font-weight: 700; text-transform: uppercase; cursor: pointer; font-size: 0.85rem; letter-spacing: 0.1em;">Save Changes</button>
                    <button type="button" onclick="closeEditModal()" style="flex: 1; padding: 1rem; background: #f5f5f5; color: #000; border: 1px solid #ddd; border-radius: 4px; font-weight: 700; text-transform: uppercase; cursor: pointer; font-size: 0.85rem; letter-spacing: 0.1em;">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let products = [];
        let uploadedImages = [];
        let draggedIndex = null;
        let sizeInventoryData = {};

        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
            
            const sizeCheckboxes = document.querySelectorAll('#sizeSelector input[type="checkbox"]');
            sizeCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateInventoryInputs);
            });

            const fileInput = document.getElementById('productImage');
            fileInput.addEventListener('change', handleImageUpload);
        });

        function handleImageUpload(e) {
            const files = e.target.files;
            uploadedImages = [];
            const preview = document.getElementById('imagesPreview');
            preview.innerHTML = '';

            if (files.length === 0) return;

            Array.from(files).forEach((file) => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    // Compress image before storing
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // Reduce size
                        const maxWidth = 800;
                        const maxHeight = 1000;
                        let width = img.width;
                        let height = img.height;
                        
                        if (width > height) {
                            if (width > maxWidth) {
                                height *= maxWidth / width;
                                width = maxWidth;
                            }
                        } else {
                            if (height > maxHeight) {
                                width *= maxHeight / height;
                                height = maxHeight;
                            }
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // Compress to JPEG quality 0.7
                        const compressedData = canvas.toDataURL('image/jpeg', 0.7);
                        uploadedImages.push(compressedData);
                        renderImagePreviews();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        function renderImagePreviews() {
            const preview = document.getElementById('imagesPreview');
            preview.innerHTML = '';
            
            uploadedImages.forEach((img, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'image-preview-item';
                previewItem.draggable = true;
                previewItem.dataset.index = index;
                
                previewItem.innerHTML = `
                    <div class="image-order-badge">${index + 1}</div>
                    <img src="${img}" alt="Preview ${index + 1}">
                    <button class="remove-image-btn" type="button" onclick="removeImage(${index})" title="Remove">×</button>
                `;
                
                previewItem.addEventListener('dragstart', handleDragStart);
                previewItem.addEventListener('dragend', handleDragEnd);
                previewItem.addEventListener('dragover', handleDragOver);
                previewItem.addEventListener('drop', handleDrop);
                previewItem.addEventListener('dragleave', handleDragLeave);
                
                preview.appendChild(previewItem);
            });
        }

        function handleDragStart(e) {
            draggedIndex = parseInt(this.dataset.index);
            this.classList.add('dragging');
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            document.querySelectorAll('.image-preview-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            e.preventDefault();
            this.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const targetIndex = parseInt(this.dataset.index);
            
            if (draggedIndex !== targetIndex) {
                const temp = uploadedImages[draggedIndex];
                uploadedImages[draggedIndex] = uploadedImages[targetIndex];
                uploadedImages[targetIndex] = temp;
                renderImagePreviews();
            }
            
            this.classList.remove('drag-over');
        }

        function removeImage(index) {
            uploadedImages.splice(index, 1);
            renderImagePreviews();
        }

        function addColorInput() {
            const colorsList = document.getElementById('colorsList');
            const colorItem = document.createElement('div');
            colorItem.className = 'color-item';
            colorItem.innerHTML = `
                <div class="color-input">
                    <input type="color" class="color-picker" value="#000000">
                    <input type="text" class="color-name" placeholder="Color name (e.g., Black, Silver)">
                </div>
                <button class="btn btn-danger" type="button" onclick="this.parentElement.remove()">Remove</button>
            `;
            colorsList.appendChild(colorItem);
        }

        function updateInventoryInputs() {
            const selected = Array.from(document.querySelectorAll('#sizeSelector input:checked'))
                .map(input => input.value);
            
            const inventoryList = document.getElementById('inventoryInputList');
            
            document.querySelectorAll('.inventory-input-row').forEach(row => {
                const inputs = row.querySelectorAll('input');
                const sizeText = row.querySelector('div').textContent;
                sizeInventoryData[sizeText] = {
                    quantity: inputs[0].value,
                    outOfStock: inputs[1].checked
                };
            });

            inventoryList.innerHTML = '';

            selected.forEach(size => {
                const row = document.createElement('div');
                row.className = 'inventory-input-row';
                
                const savedData = sizeInventoryData[size] || { quantity: '0', outOfStock: false };
                
                row.innerHTML = `
                    <div style="font-weight: 600;">${size}</div>
                    <input type="number" placeholder="Quantity in stock" value="${savedData.quantity}" min="0" data-size="${size}">
                    <input type="checkbox" data-size="${size}" title="Out of Stock" ${savedData.outOfStock ? 'checked' : ''}>
                `;
                inventoryList.appendChild(row);
            });
        }

        function createProduct() {
            const nameInput = document.getElementById('productName');
            const name = nameInput ? nameInput.value.trim() : '';
            
            if (!name) {
                alert('❌ Product name is required');
                return;
            }
            
            if (uploadedImages.length === 0) {
                alert('❌ Please upload at least one image');
                return;
            }

            try {
                const colors = [];
                const sizes = [];
                document.querySelectorAll('.inventory-input-row').forEach(row => {
                    const inputs = row.querySelectorAll('input');
                    const sizeText = row.querySelector('div').textContent;
                    const quantity = inputs[0].value;
                    const outOfStock = inputs[1].checked;
                    sizes.push({ size: sizeText, quantity: quantity || 0, outOfStock });
                });

                const product = {
                    id: Date.now(),
                    name: name,
                    category: document.getElementById('productCategory').value || 'Uncategorized',
                    price: document.getElementById('productPrice').value || null,
                    description: document.getElementById('productDescription').value || 'No description',
                    images: uploadedImages.slice(),
                    colors: colors,
                    sizes: sizes
                };

                products.push(product);
                saveProducts();
                
                alert('✅ Product created successfully!');
                displayProducts();
                resetForm();
            } catch (error) {
                console.error('Error:', error);
                alert('❌ Error: ' + error.message);
            }
        }

        function saveProducts() {
            localStorage.setItem('mohsenProducts', JSON.stringify(products));
        }

        function loadProducts() {
            const saved = localStorage.getItem('mohsenProducts');
            products = saved ? JSON.parse(saved) : [];
            displayProducts();
        }

        function displayProducts() {
            const list = document.getElementById('productsList');
            if (products.length === 0) {
                list.innerHTML = '<div class="empty-state"><p style="font-size: 1.1rem;">No products yet. Create your first product above.</p></div>';
                return;
            }

            list.innerHTML = products.map(product => `
                <div class="product-item">
                    <div class="product-image">
                        <img src="${product.images[0]}" alt="${product.name}">
                        ${product.images.length > 1 ? `<div style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 600;">+${product.images.length - 1}</div>` : ''}
                    </div>
                    <div class="product-details">
                        <div class="product-header">
                            <div>
                                <div class="product-name">${product.name}</div>
                                <div class="product-category">${product.category}</div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-add" type="button" onclick="editProduct(${product.id})" style="padding: 0.6rem 1.2rem; font-size: 0.75rem;">Edit</button>
                                <button class="btn btn-danger" type="button" onclick="deleteProduct(${product.id})">Delete</button>
                            </div>
                        </div>
                        <div class="product-price">${product.price ? 'AED ' + product.price : 'Price on Request'}</div>
                        <p class="product-desc">${product.description}</p>
                        
                        ${product.colors.length > 0 ? `
                        <div class="product-colors">
                            <label>Available Colors:</label>
                            <div class="color-dots">
                                ${product.colors.map(c => `<div class="color-dot" style="background-color: ${c.hex};" title="${c.name}"></div>`).join('')}
                            </div>
                        </div>
                        ` : ''}

                        ${product.sizes.length > 0 ? `
                        <label style="font-size: 0.8rem; font-weight: 700; text-transform: uppercase; display: block; margin-bottom: 0.8rem; color: #333;">Inventory:</label>
                        <table class="inventory-table">
                            <thead>
                                <tr>
                                    <th>Size</th>
                                    <th>Stock</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${product.sizes.map(s => `
                                    <tr>
                                        <td>${s.size}</td>
                                        <td>${s.outOfStock ? '-' : s.quantity}</td>
                                        <td>${s.outOfStock ? '<span style="color: #999; font-weight: 600;">Out of Stock</span>' : '<span style="color: #333; font-weight: 600;">In Stock</span>'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        let currentEditingProductId = null;

        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;

            currentEditingProductId = id;
            document.getElementById('editProductName').value = product.name;
            document.getElementById('editProductCategory').value = product.category;
            document.getElementById('editProductPrice').value = product.price || '';
            document.getElementById('editProductDescription').value = product.description;

            // Populate inventory table
            const inventoryList = document.getElementById('editInventoryList');
            inventoryList.innerHTML = '';

            if (product.sizes && product.sizes.length > 0) {
                product.sizes.forEach(size => {
                    const row = document.createElement('div');
                    row.className = 'inventory-input-row';
                    row.innerHTML = `
                        <div style="font-weight: 600;">${size.size}</div>
                        <input type="number" value="${size.quantity}" min="0" data-size="${size.size}" class="edit-quantity">
                        <input type="checkbox" ${size.outOfStock ? 'checked' : ''} data-size="${size.size}" class="edit-outofstock">
                    `;
                    inventoryList.appendChild(row);
                });
            } else {
                inventoryList.innerHTML = '<div style="padding: 1rem; text-align: center; color: #999;">No sizes available</div>';
            }

            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditingProductId = null;
        }

        function saveEditProduct() {
            if (!currentEditingProductId) return;

            const product = products.find(p => p.id === currentEditingProductId);
            if (!product) return;

            const name = document.getElementById('editProductName').value.trim();
            if (!name) {
                alert('Product name is required');
                return;
            }

            product.name = name;
            product.category = document.getElementById('editProductCategory').value;
            product.price = document.getElementById('editProductPrice').value || null;
            product.description = document.getElementById('editProductDescription').value;

            // Save updated sizes
            const updatedSizes = [];
            document.querySelectorAll('.edit-quantity').forEach(input => {
                const size = input.getAttribute('data-size');
                const quantity = input.value;
                const outOfStock = input.parentElement.querySelector('.edit-outofstock').checked;
                updatedSizes.push({ size, quantity: quantity || 0, outOfStock });
            });

            if (updatedSizes.length > 0) {
                product.sizes = updatedSizes;
            }

            saveProducts();
            displayProducts();
            closeEditModal();
            alert('✅ Product updated successfully!');
        }

        function deleteProduct(id) {
            if (confirm('Are you sure you want to delete this product?')) {
                products = products.filter(p => p.id !== id);
                saveProducts();
                displayProducts();
            }
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('editModal');
            if (event.target === modal) {
                closeEditModal();
            }
        });

        function resetForm() {
            document.getElementById('productName').value = '';
            document.getElementById('productCategory').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productDescription').value = '';
            document.getElementById('productImage').value = '';
            document.getElementById('imagesPreview').innerHTML = '';
            document.getElementById('colorsList').innerHTML = '';
            document.getElementById('inventoryInputList').innerHTML = '';
            document.querySelectorAll('#sizeSelector input[type="checkbox"]').forEach(cb => cb.checked = false);
            uploadedImages = [];
            sizeInventoryData = {};
        }

        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
            })
            .catch(e => console.log('Header not found'));

        function toggleMenu() {
            const menu = document.getElementById('mobileMenu');
            const toggle = document.querySelector('.menu-toggle');
            if (menu && toggle) {
                menu.classList.toggle('active');
                toggle.classList.toggle('active');
            }
        }

        function closeMenu() {
            const menu = document.getElementById('mobileMenu');
            const toggle = document.querySelector('.menu-toggle');
            if (menu && toggle) {
                menu.classList.remove('active');
                toggle.classList.remove('active');
            }
        }

        function openCart() {
            alert('Cart is not available in admin panel');
        }
    </script>
</body>
</html>